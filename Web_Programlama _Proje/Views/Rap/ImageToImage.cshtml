@* @{
    ViewData["Title"] = "Hairstyle Changer";
}

<h1>Saç Modeli Değiştirme</h1>

<form method="post" enctype="multipart/form-data" asp-controller="Rap" asp-action="ImageToImage">
    <div>
        <label for="imageFile">Resim Yükle (PNG/JPG):</label>
        <input type="file" id="imageFile" name="imageFile" accept="image/*" required />
        @if (ViewData.ModelState["imageFile"]?.Errors?.Count > 0)
        {
            <span style="color:red">@ViewData.ModelState["imageFile"].Errors[0].ErrorMessage</span>
        }
    </div>
    <div>
        <label for="hairType">Saç Tipi:</label>
        <input type="text" id="hairType" name="hairType" value="301" />
        @if (ViewData.ModelState["hairType"]?.Errors?.Count > 0)
        {
            <span style="color:red">@ViewData.ModelState["hairType"].Errors[0].ErrorMessage</span>
        }
    </div>
    <button type="submit">Gönder</button>

    @if (ViewData.ModelState[""]?.Errors?.Count > 0)
    {
        <p style="color:red">@ViewData.ModelState[""].Errors[0].ErrorMessage</p>
    }
</form>

@if (ViewBag.ResultImage != null)
{
    <h2>Sonuç:</h2>
    <img src="@ViewBag.ResultImage" alt="Result Image" />
}

@if (ViewBag.ApiRawResponse != null)
{
    <h3>API JSON Yanıtı:</h3>
    <pre>@ViewBag.ApiRawResponse</pre>
}
 *@
@* @{
    ViewData["Title"] = "Hairstyle Changer";
}

<h1>Saç Modeli Değiştirme</h1>

<form method="post" enctype="multipart/form-data" asp-controller="Rap" asp-action="ImageToImage">
    <div>
        <label for="imageFile">Resim Yükle (PNG/JPG):</label>
        <input type="file" id="imageFile" name="imageFile" accept="image/*" required />

        <!-- FileReader ile önizleme (Client-side) -->
        <img id="previewImage"
             alt="Önizleme"
             style="max-width: 200px; max-height: 200px; display: block; margin-top: 10px;" />

        @if (ViewData.ModelState["imageFile"]?.Errors?.Count > 0)
        {
            <span style="color:red">
                @ViewData.ModelState["imageFile"].Errors[0].ErrorMessage
            </span>
        }
    </div>
    <div>
        <label for="hairType">Saç Tipi:</label>
        <input type="text" id="hairType" name="hairType" value="301" />

        @if (ViewData.ModelState["hairType"]?.Errors?.Count > 0)
        {
            <span style="color:red">
                @ViewData.ModelState["hairType"].Errors[0].ErrorMessage
            </span>
        }
    </div>
    <button type="submit">Gönder</button>

    @if (ViewData.ModelState[""]?.Errors?.Count > 0)
    {
        <p style="color:red">
            @ViewData.ModelState[""].Errors[0].ErrorMessage
        </p>
    }
</form>

<hr />

<!-- 1) Sunucuya Gönderildikten Sonra: Kullanıcının Yüklediği Resim -->
@if (ViewBag.UploadedImageBase64 != null)
{
    <h3>Yüklediğiniz Fotoğraf:</h3>
    <img src="data:image/png;base64,@ViewBag.UploadedImageBase64"
         alt="Yüklenen Resim"
         style="max-width:200px;max-height:200px;" />
}

<!-- 2) API'nin Döndürdüğü İşlenmiş Resim -->
@if (ViewBag.ResultImage != null)
{
    <h3>İşlenmiş Resim (API Yanıtı):</h3>
    <img src="@ViewBag.ResultImage" alt="Result Image"
         style="max-width: 200px; max-height: 200px;" />
}

<!-- 3) Eğer API döndürdüğü JSON'u da göstermek isterseniz -->
@if (ViewBag.ApiRawResponse != null)
{
    <h3>API JSON Yanıtı:</h3>
    <pre>@ViewBag.ApiRawResponse</pre>
}

@section Scripts {
    <script>
        // FileReader ile anında önizleme
        const imageInput = document.getElementById('imageFile');
        const previewImg = document.getElementById('previewImage');

        imageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Dosya base64 formatında yüklendi
                    previewImg.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                previewImg.src = "";
            }
        });
    </script>
}

@if (ViewBag.ResultImage != null)
{
    <h2>Sonuç:</h2>
    <img src="@ViewBag.ResultImage" alt="Result Image" style="max-width: 200px;" />
}

@if (ViewBag.ApiRawResponse != null)
{
    <h3>API JSON Yanıtı:</h3>
    <pre>@ViewBag.ApiRawResponse</pre>
}
 *@
@* @{
    ViewData["Title"] = "Multiple Hair Styles";
}

<h1>Farklı 5 Saç Modeli Deneme</h1>

<!-- Form: Kullanıcı tek fotoğraf yükler -->
<form method="post" enctype="multipart/form-data" asp-controller="Rap" asp-action="ImageToImage">
    <div>
        <label for="imageFile">Resim Yükle (PNG/JPG):</label>
        <input type="file" id="imageFile" name="imageFile" accept="image/*" required />
    </div>
    <button type="submit">Gönder</button>
</form>

<!-- Hata Mesajları -->
@if (!ViewData.ModelState.IsValid)
{
    foreach (var modelState in ViewData.ModelState.Values)
    {
        foreach (var error in modelState.Errors)
        {
            <p style="color:red">@error.ErrorMessage</p>
        }
    }
}

<hr />

<!-- Kullanıcının Yüklediği Fotoğraf (Sunucuya gönderildi) -->
@if (ViewBag.UploadedImageBase64 != null)
{
    <h3>Yüklenen Fotoğraf:</h3>
    <img src="data:image/png;base64,@ViewBag.UploadedImageBase64"
         alt="Uploaded Image"
         style="max-width:200px;max-height:200px;" />
}

<!-- 5 Farklı Saç Modelinin Sonuçları -->
@if (ViewBag.HairStyleResults != null)
{
    <h2>Saç Modeli Sonuçları</h2>
    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        @foreach (var hairTypeKey in ((Dictionary<string, string>)ViewBag.HairStyleResults).Keys)
        {
            var imageSrc = ((Dictionary<string, string>)ViewBag.HairStyleResults)[hairTypeKey];

            <div style="border:1px solid #ccc; padding:10px; text-align:center;">
                <p>Saç Tipi: @hairTypeKey</p>
                @if (imageSrc != null)
                {
                    <img src="@imageSrc" alt="Result Image"
                         style="max-width:200px;max-height:200px;" />
                }
                else
                {
                    <p style="color:red;">API Hatası / Görsel alınamadı.</p>
                }
            </div>
        }
    </div>
}
 *@
@{
    ViewData["Title"] = "Farklı 5 Saç Modeli Deneme";
}

<h1>Farklı 5 Saç Modeli Deneme</h1>

<!-- Form: Kullanıcı tek fotoğraf yükler -->
<form method="post" enctype="multipart/form-data" asp-controller="Rap" asp-action="ImageToImage">
    <div>
        <label for="imageFile">Resim Yükle (PNG/JPG):</label>
        <input type="file" id="imageFile" name="imageFile" accept="image/*" required />

        <!-- FileReader ile anında önizleme (Tarayıcı tarafında) -->
        <img id="previewImage"
             alt="Önizleme"
             style="max-width: 200px; max-height: 200px; display: block; margin-top: 10px;" />
    </div>
    <button type="submit">Gönder</button>
</form>

<!-- Hata Mesajları -->
@if (!ViewData.ModelState.IsValid)
{
    foreach (var modelState in ViewData.ModelState.Values)
    {
        foreach (var error in modelState.Errors)
        {
            <p style="color:red">@error.ErrorMessage</p>
        }
    }
}

<hr />

<!-- 1) Sunucuya Gönderildikten Sonra: Kullanıcının Yüklediği Resim (base64) -->
@if (ViewBag.UploadedImageBase64 != null)
{
    <h3>Yüklenen Fotoğraf:</h3>
    <div style="border:1px solid #ccc; padding:10px; text-align:center; width:220px;">
        <img src="data:image/png;base64,@ViewBag.UploadedImageBase64"
             alt="Yüklenen Resim"
             style="max-width:200px; max-height:200px;" />
        <!--
            BURADA artık herhangi bir “İndir” linki yok,
            çünkü sadece işlenmiş sonuçlarda indirme izni vereceğiz.
        -->
    </div>
}

<!-- 2) 5 Farklı Saç Modelinin Sonuçları -->
@if (ViewBag.HairStyleResults != null)
{
    <h2>Saç Modeli Sonuçları</h2>
    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        @foreach (var hairTypeKey in ((Dictionary<string, string>)ViewBag.HairStyleResults).Keys)
        {
            var imageSrc = ((Dictionary<string, string>)ViewBag.HairStyleResults)[hairTypeKey];

            <div style="border:1px solid #ccc; padding:10px; text-align:center; width:220px;">
                <p>Saç Tipi: @hairTypeKey</p>
                @if (imageSrc != null)
                {
                    <img src="@imageSrc" alt="Result Image"
                         style="max-width:200px;max-height:200px;" />
                    <br />
                    <!-- İşlenmiş resmi indirme butonu -->
                    <a href="@imageSrc"
                       download="hair_@(hairTypeKey).png"
                       style="text-decoration: none; color: #fff; background-color: #28a745;
                              padding:5px 10px; border-radius:4px; margin-top:5px; display:inline-block;">
                        İndir
                    </a>
                }
                else
                {
                    <p style="color:red;">API Hatası / Görsel alınamadı.</p>
                }
            </div>
        }
    </div>
}

@section Scripts {
    <script>
        // Dosya seçilince tarayıcıda anında önizleme
        const imageInput = document.getElementById('imageFile');
        const previewImg = document.getElementById('previewImage');

        imageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                previewImg.src = "";
            }
        });
    </script>
}
